<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Symptom Checker</title>
  <!-- Tailwind CSS via CDN -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.2.7/dist/tailwind.min.css" rel="stylesheet"/>
</head>
<body class="bg-gray-100 text-gray-900 min-h-screen p-4">
  <div class="max-w-xl mx-auto mt-10">
    <h1 class="text-2xl font-bold mb-4 text-center">Symptom Checker</h1>
    
    <!-- Symptom input + suggestion list -->
    <div class="mb-4">
      <label for="symptomInput" class="block font-semibold mb-1">Add a symptom</label>
      <input 
        id="symptomInput"
        type="text" 
        class="w-full rounded border border-gray-300 p-2"
        placeholder="Type to search for a symptom..." 
      />
      <ul id="suggestions" class="border border-gray-300 rounded bg-white mt-1 hidden"></ul>
    </div>
    
    <!-- Chosen symptoms container -->
    <div class="mb-4">
      <h2 class="font-semibold mb-2">Selected Symptoms:</h2>
      <div id="selectedSymptoms" class="flex flex-wrap gap-2"></div>
    </div>
    
    <!-- Predict button -->
    <button 
      id="predictBtn" 
      class="bg-blue-500 text-white font-semibold py-2 px-4 rounded hover:bg-blue-600"
    >
      Predict Disease
    </button>
    
    <!-- Results -->
    <div id="results" class="mt-6 p-4 bg-white rounded shadow hidden">
      <h2 class="text-xl font-semibold mb-4">Possible Diseases</h2>
      <ul id="diseaseList" class="list-disc list-inside"></ul>
    </div>
  </div>
  
  <!-- Inline JS for demonstration -->
  <script>
    const symptomInput = document.getElementById('symptomInput');
    const suggestionsList = document.getElementById('suggestions');
    const selectedSymptomsDiv = document.getElementById('selectedSymptoms');
    const predictBtn = document.getElementById('predictBtn');
    const resultsDiv = document.getElementById('results');
    const diseaseList = document.getElementById('diseaseList');
    
    let selectedSymptoms = [];
    
    async function fetchSuggestions(prefix) {
      if (!prefix) {
        suggestionsList.classList.add('hidden');
        return;
      }
      try {
        const res = await fetch(`/api/suggest_symptoms?prefix=${encodeURIComponent(prefix)}`);
        const data = await res.json();
        // Populate suggestions
        suggestionsList.innerHTML = '';
        if (data.length === 0) {
          suggestionsList.classList.add('hidden');
          return;
        }
        data.forEach(symptom => {
          const li = document.createElement('li');
          li.className = 'px-2 py-1 cursor-pointer hover:bg-gray-200';
          li.textContent = symptom;
          li.addEventListener('click', () => {
            addSymptom(symptom);
            suggestionsList.classList.add('hidden');
            symptomInput.value = '';
          });
          suggestionsList.appendChild(li);
        });
        suggestionsList.classList.remove('hidden');
      } catch (err) {
        console.error(err);
      }
    }
    
    function addSymptom(symptom) {
      if (!selectedSymptoms.includes(symptom)) {
        selectedSymptoms.push(symptom);
        renderSelectedSymptoms();
      }
    }
    
    function removeSymptom(symptom) {
      selectedSymptoms = selectedSymptoms.filter(s => s !== symptom);
      renderSelectedSymptoms();
    }
    
    function renderSelectedSymptoms() {
      selectedSymptomsDiv.innerHTML = '';
      selectedSymptoms.forEach(sym => {
        const badge = document.createElement('div');
        badge.className = "bg-blue-100 text-blue-700 px-3 py-1 rounded-full flex items-center";
        badge.innerHTML = `${sym} <span class="ml-2 cursor-pointer text-red-500 font-bold">x</span>`;
        badge.querySelector('span').addEventListener('click', () => removeSymptom(sym));
        selectedSymptomsDiv.appendChild(badge);
      });
    }
    
    symptomInput.addEventListener('input', (e) => {
      fetchSuggestions(e.target.value);
    });
    
    predictBtn.addEventListener('click', async () => {
      if (selectedSymptoms.length === 0) {
        alert("Please select at least one symptom");
        return;
      }
      try {
        const res = await fetch('/api/predict_disease', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ symptoms: selectedSymptoms })
        });
        const data = await res.json();
        // data is an array of { disease, probability }
        diseaseList.innerHTML = '';
        data.forEach(item => {
          const li = document.createElement('li');
          li.textContent = `${item.disease} (Prob: ${(item.probability * 100).toFixed(2)}%)`;
          diseaseList.appendChild(li);
        });
        resultsDiv.classList.remove('hidden');
      } catch (err) {
        console.error(err);
      }
    });
  </script>
</body>
</html>
